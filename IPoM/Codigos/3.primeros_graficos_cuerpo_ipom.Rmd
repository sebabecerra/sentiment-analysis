---
title: "Primeros_graficos_cuerpo"
author: "seba"
date: "02-06-2020"
output: html_document
---
Cargamos los resumenes del IEF


```{r}
rm(list = ls())
path="D:/Trabajo/TextMining/ProyectoFinal/Cuerpo/ief_x_palabra/"
file.remove(paste0(path,"Models_appended.txt"))
files <- dir(path, pattern = "*.txt")
  DF <-  read.csv(paste0(path, files[1]))
  DF$fecha<- as.character(gsub(".txt", "", files[1]))

#reading each file within the range and append them to create one file
for (f in files[-1]){
  df <- read.csv(paste0(path,f))      # read the file
  df$fecha<- as.character(gsub(".txt", "", f))
  df$fecha<- stripWhitespace(df$fecha)
  DF <- rbind(DF, df)    # append the current file
}
  
write.csv(DF, paste0(path, "Models_appended.txt"), row.names=FALSE, quote=FALSE)
```

Graficos

```{r}
DF1 <- gsub('.{2}$', '', DF$fecha)
DF <- cbind(DF,DF1)
DF <- DF %>%  select(-X)
```

```{r}
DF$PR="VC"
DF$PR[DF$DF1 %in% c(2008,2009,2010,2011)] <- "JDG"
DF$PR[DF$DF1 %in% c(2012,2013,2014,2015,2016)] <- "RV"
DF$PR[DF$DF1 %in% c(2017,2018,2019,2020)] <- "MM"

DF$GDPF="LOH"
DF$GDPF[DF$DF1 %in% c(2006,2007)] <- "PGS"
DF$GDPF[DF$DF1 %in% c(2008,2009,2010,2011,2012,2013,2014)] <- "KCL"
DF$GDPF[DF$fecha %in% c("2014_2")] <- "CRK"
DF$GDPF[DF$DF1 %in% c(2015,2016)] <- "CRK"
DF$GDPF[DF$DF1 %in% c(2017,2018,2019,2020)] <- "SBJ"

DF$den_pr=8
DF$den_pr[DF$DF1 %in% c(2008,2009,2010,2011)] <- 8
DF$den_pr[DF$DF1 %in% c(2012,2013,2014,2015,2016)] <- 10
DF$den_pr[DF$DF1 %in% c(2017,2018,2019,2020)] <- 8

DF$den_GDPF=4
DF$den_GDPF[DF$DF1 %in% c(2006,2007)] <- 4
DF$den_GDPF[DF$DF1 %in% c(2008,2009,2010,2011,2012,2013,2014)] <- 13
DF$den_GDPF[DF$fecha %in% c("2014_2")] <- 5
DF$den_GDPF[DF$DF1 %in% c(2015,2016)] <- 5
DF$den_GDPF[DF$DF1 %in% c(2017,2018,2019,2020)] <- 8

#DF$g <- DF %>% group_by(PR, fecha) %>% group_indices
DF <- DF %>% group_by(fecha) %>%  mutate(tw = n()/n())
DF <- DF %>% group_by(PR) %>% mutate(meanpr = sum(tw)/den_pr)
DF <- DF %>% group_by(GDPF) %>% mutate(meangdpf = sum(tw)/den_GDPF)
DF <- DF %>% group_by(fecha) %>% mutate(tw2 = sum(tw))
DF$TTWW=mean(DF$tw2)


```

```{r}
path="D:/Trabajo/TextMining/ProyectoFinal/Graficos/"
#png(paste0(path,"total_palabras_pr.png"), width=1000,height=800)
g <- ggplot(DF, aes(x=(fecha), fill=PR) )
g + geom_bar(aes(x=fecha), position = "dodge") + geom_point(aes(x=fecha, y=meanpr, size=3), show.legend = FALSE)+ geom_point(aes(x=fecha, y=TTWW, colour="red",size=3), show.legend = FALSE)+ scale_x_discrete(labels = c("2004","","","","2006","","","","2008", "","","","2010","","","","2012", "","","","2014","","","","2016","","","","2018","","","",2020))+
  scale_fill_discrete(breaks=c("VC","JDG","RV", "MM"))+
   coord_cartesian(ylim=c(0,20000))+
  theme(axis.text.x = element_text(face="plain", color="black", 
                           size=30, angle=0, vjust = 1),
          axis.text.y = element_text(face="plain", color="black", 
                           size=30, angle=0, vjust = 0.2),plot.title = element_text(hjust = 0.5) ) + theme(legend.position='bottom', legend.title = element_blank(),legend.text = element_text(size = 20))+  xlab("") + ylab("") 
#dev.off() 
```


```{r}
path="D:/Trabajo/TextMining/ProyectoFinal/Graficos/"
png(paste0(path,"total_palabras_pr2.png"), width=1100,height=800)
g <- ggplot(DF, aes(x=(fecha), fill=PR) )
g + geom_bar(aes(x=fecha), position = "dodge")+ geom_hline(yintercept=11295)+ scale_x_discrete(labels = c("2004","","","","2006","","","","2008", "","","","2010","","","","2012", "","","","2014","","","","2016","","","","2018","","","",2020,"","", "",""))+
scale_fill_discrete(breaks=c("VC","JDG","RV", "MM"))+
coord_cartesian(ylim=c(0,20500))+ scale_y_continuous(expand = c(0, 0))+theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  theme(axis.text.x = element_text(face="plain", color="black", 
                           size=30, angle=0, vjust = 0, hjust=0.62),
          axis.text.y = element_text(face="plain", color="black", 
                           size=30, angle=0, vjust = 0),plot.title = element_text(hjust = 0.5) ) + theme(legend.position='bottom', legend.title = element_blank(),legend.text = element_text(size = 20))+  xlab("") + ylab("")
dev.off() 
```



Una vez extraídos los textos, el IEF se divide en dos subconjuntos, uno con el resumen y otro con el resto del cuerpo. El motivo de esta separación radica en que, generalmente, los procesos de redacción y discusión entre ambas partes suelen ser distintos; y, en particular, el resumen habitualmente está sujeta a una revisión más intensa. El Cuerpo del Informe, una vez procesado, tiene una media de 11.770 palabras. Sein embargo a lo largo del tiempo y de acuerdo al presidente en ejercico podemos clasificar en cuatro periodos. El primero desde 2004 hasta el 2007, seguido por el periodo 2008-2011,2012-2016 y 2017 a 2020, donde  la media del cuerpo del IEF fue de 10215, 10981, 11267 y 15873 respectivamente. En cuanto al Resumen tenemos XXX.

El aumento significativo del numero de palabras en el último período parece estar justificado por el mayor número de recuadros junto con la incluión de un capítulo temático. Para màs detalle ver graficos XXX  

Podemos hacer la misma descomposición pero esta vez en base al gerente de estabilidad financiera. Persona directamente a cargo del IEF. 


```{r}
path="D:/Trabajo/TextMining/ProyectoFinal/Graficos/"
#png(paste0(path,"total_palabras_gdpf.png"), width=1000,height=800)
g <- ggplot(DF, aes(x=(fecha), fill=GDPF) )
g + geom_bar(aes(x=fecha), position = "dodge") + geom_point(aes(x=fecha, y=meangdpf, size=3), show.legend = FALSE)+ geom_point(aes(x=fecha, y=TTWW, colour="red", size=3), show.legend = FALSE)+ scale_x_discrete(labels = c("2004","","","","2006","","","","2008", "","","","2010","","","","2012", "","","","2014","","","","2016","","","","2018","","","",2020))+
  scale_fill_discrete(breaks=c("LOH","PGS","KCL", "CRK", "SBJ"))+
   coord_cartesian(ylim=c(0,20000))+
  theme(axis.text.x = element_text(face="plain", color="black", 
                           size=30, angle=0, vjust = 1),
          axis.text.y = element_text(face="plain", color="black", 
                           size=30, angle=0, vjust = 0.2),plot.title = element_text(hjust = 0.5) ) + theme(legend.position='bottom', legend.title = element_blank(),legend.text = element_text(size = 20))+  xlab("") + ylab("") 
#dev.off() 
```


```{r}
path="D:/Trabajo/TextMining/ProyectoFinal/Graficos/"
png(paste0(path,"total_palabras.png"), width=1100,height=800)
g1 <- ggplot(DF, aes(x=(fecha), fill=fecha) )
g1 + geom_bar(aes(x=fecha), position = "dodge", show.legend = FALSE) +   ggplot2::annotate(
    geom = "curve", x = 20, y = 13500, xend = 19, yend = 11300, 
    curvature = .3, size=1,arrow = arrow(length = unit(5, "mm")))+ggplot2::annotate(geom = "text", x =21 , y = 14000, label = "Promedio", hjust = "rigth", size=12)+ scale_x_discrete(labels = c("2004","","","","2006","","","","2008", "","","","2010","","","","2012", "","","","2014","","","","2016","","","","2018","","","",2020,"","", "",""))+
  scale_fill_manual(values=c("grey50", "grey50", "grey50", "grey50","grey50","grey50","grey50","grey50","grey50","grey50","grey50","grey50","black","grey50","black","grey50","grey50","grey50","grey50","grey50","grey50","grey50","grey50","grey50","grey50","grey50","grey50","black","black","black", "black","black","black")) +
    coord_cartesian(ylim=c(0,20500))+ scale_y_continuous(expand = c(0, 0))+ geom_hline(yintercept=11295)+ theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
panel.grid.minor = element_blank(), axis.line = element_line(colour = "black"))+
  theme(axis.text.x = element_text(face="plain", color="black", 
                           size=30, angle=0, vjust = 0, hjust=0.62),
          axis.text.y = element_text(face="plain", color="black", 
                           size=30, angle=0, vjust = 0),plot.title = element_text(hjust = 0.5) ) + theme(legend.position='bottom', legend.title = element_blank(),legend.text = element_text(size = 20))+  xlab("") + ylab("")
dev.off() 
```


```{r}

promedios=aggregate(DF,
                by = list(DF$fecha, DF$PR),
                FUN = mean)

promedios <- promedios %>% mutate(promgral = mean(tw2))
```


